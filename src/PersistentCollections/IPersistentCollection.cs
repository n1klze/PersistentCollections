namespace PersistentCollections;

/// <summary>
/// Базовый интерфейс для персистентных коллекций с поддержкой undo/redo.
///
/// <para>
/// Персистентная коллекция — это иммутабельная структура данных,
/// где каждая операция возвращает новую версию,
/// а старые версии остаются валидными и неизменными.
/// </para>
///
/// <para>
/// Интерфейс использует шаблон "self type" (CRTP-подобный паттерн),
/// чтобы методы <see cref="Undo"/> и <see cref="Redo"/>
/// возвращали конкретный тип коллекции,
/// а не общий интерфейс.
/// </para>
/// </summary>
/// <typeparam name="TSelf">
/// Конкретный тип персистентной коллекции.
/// Обычно это сам реализующий класс
/// (например, <c>PersistentList&lt;T&gt;</c> или <c>PersistentLinkedList&lt;T&gt;</c>).
/// </typeparam>
public interface IPersistentCollection<TSelf>
    where TSelf : IPersistentCollection<TSelf>
{
    /// <summary>
    /// Откатывает коллекцию к предыдущей версии.
    ///
    /// <para>
    /// Текущая версия перемещается в redo-историю,
    /// а предыдущая версия становится текущей.
    /// </para>
    ///
    /// <para>
    /// Реализация должна использовать связанный объект истории
    /// (например, <c>History&lt;TSelf&gt;</c>),
    /// а не изменять текущее состояние коллекции.
    /// </para>
    /// </summary>
    /// <returns>
    /// Предыдущая версия коллекции, которая становится текущей после отката.
    /// </returns>
    /// <exception cref="InvalidOperationException">
    /// Выбрасывается, если в истории нет предыдущих версий
    /// (то есть undo невозможен).
    /// </exception>
    TSelf Undo();

    /// <summary>
    /// Повторно применяет ранее отменённую версию коллекции.
    ///
    /// <para>
    /// Перемещает верхнюю версию из redo-истории обратно в undo-историю
    /// и делает её текущей.
    /// </para>
    ///
    /// <para>
    /// Если после <see cref="Undo"/> была выполнена новая операция,
    /// redo-история должна быть очищена,
    /// и вызов <see cref="Redo"/> должен завершиться исключением.
    /// </para>
    /// </summary>
    /// <returns>
    /// Версия коллекции, которая становится текущей после выполнения redo.
    /// </returns>
    /// <exception cref="InvalidOperationException">
    /// Выбрасывается, если redo-история пуста
    /// (то есть redo невозможно).
    /// </exception>
    TSelf Redo();
}
